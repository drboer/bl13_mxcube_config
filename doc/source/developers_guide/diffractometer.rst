+++++++++++++++++++++++++++
Diffractometer
+++++++++++++++++++++++++++

-----------
Description
-----------
As the beamline supervisor coordinates the combined operation of beamline devices, the
diffractometer sample changer allows to see the collection of devices included in the
diffractometer as one single device.

The diffractometer device server takes care of implementing the phases listed above
by talking to its own components. For example, when the beamline supervisor requests
the diffractometer to set itself in transfer phase mode, the diffractometer device server
will drive its own components to reach that phase: light, attenuator, yag positioner will
be moved down; once all devices are down the ln2 cover will be closed; in parallel omega
and other diffractometer motors may need to be moved to its sample mounting position. The
diffractometer device server will free the beamline supervisor from all these details.

:TANGO DS: XalocDiffractometer/bl13
:Device: bl13/eh/diffractometer

This device server runs at `bl13mxcube` host (TANGO 8)

********************************
XALOC beamline phase definitions
********************************

**Phase codes:**

    * SAMPLE = 1
    * TRANSFER = 2
    * BEAM = 3
    * COLLECT = 4
    * UNKNOWN = 5

**Beamstop Types:**

    * NOTSET = 0
    * FIXED = 1
    * MOVEABLE = 2
    * AUTO_FIXED = 3
    * AUTO_MOVEABLE = 4


Diffractometer
==============

+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| Property                 | Attribute                  | Type                 | Role(Key in core.py)     | Dict (in core.py)    | Device             | Attribute                        | Type                 |
+==========================+============================+======================+==========================+======================+====================+==================================+======================+
| omega                    | ---                        | ---                  | omega                    | motor_names          | omega              | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| omegax                   | ---                        | ---                  | omegax                   | motor_names          | omegax             | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| omegay                   | ---                        | ---                  | omegay                   | motor_names          | omegay             | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| omegaz                   | ---                        | ---                  | omegaz                   | motor_names          | omegaz             | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| centx                    | ---                        | ---                  | centx                    | motor_names          | centx              | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| centy                    | ---                        | ---                  | centy                    | motor_names          | centy              | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| diftabx                  | ---                        | ---                  | diftabx                  | table_motor_names    | diftabx            | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| diftabz                  | ---                        | ---                  | diftabz                  | table_motor_names    | diftabz            | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| diftabyaw                | ---                        | ---                  | diftabyaw                | table_motor_names    | diftabyaw          | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| diftabpitch              | ---                        | ---                  | diftabpit                | table_motor_names    | diftabpit          | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| yagy_motor               | ---                        | ---                  | yagy_motor               | other_motor_names    | yagy               | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| yagz_motor               | YagPosition                | DevString            | tagz_motor               | motors_under_cover   | yagz               | position                         | DevDouble            |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| aperture_motor           | ApeturePosition            | DevString            | aperture_motor           | motors_under_cover   | aperz              | position                         | DevDouble            |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| beamstop_x_motor         | ---                        | ---                  | beamstop_x_motor         | motors_under_cover   | bstopx             | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| beamstop_z_motor         | BeamStopPosition           | DevString            | beamstop_z_motor         | motors_under_cover   | bstopz             | position                         | DevDouble            |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| move_beamstop_x_motor    | ---                        | ---                  | move_beamstop_x_motor    | other_motor_names    | bsx                | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| move_beamstop_y_motor    | ---                        | ---                  | move_beamstop_y_motor    | other_motor_names    | bsy                | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| move_beamstop_z_motor    | ---                        | ---                  | move_beamstop_z_motor    | other_motor_names    | bsz                | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| kappa_motor              | KappaPresence              | DevBoolean           | kappa_motor              | other_motor_names    | kappa              | StatusLimNeg                     | DevBoolean           |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| zoom_ior                 | ZoomPosition               | DevShort             | zoom                     | devnames             | zoom               | position                         | DevDouble            |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| blight                   | BacklLightLevel            | DevShort             | ---                      | ---                  | blight             | Brightness, value                | DevLong, DevDouble   |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| flight                   | FrontLightLevel            | DevShort             | ---                      | ---                  | flight             | Brightness                       | DevLong              |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| ln2cover_open            | LN2CoverOpen               | DevBoolean           | ln2cover_open            | eps_signal_names     | bl13/ct/eps-plc-01 | ln2cover                         | DevShort             |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| backlight_in             | BacklightIn                | DevBoolean           | backlight_in             | eps_signal_names     | bl13/ct/eps-plc-01 | backlight                        | DevShort             |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| som                      | SampleOnMagnet             | DevBoolean           | som                      | eps_signal_names     | bl13/ct/eps-plc-01 | SOM                              | DevBoolean           |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| yagpark                  | YagIsParked                | DevBoolean           | yagpark                  | eps_signal_names     | bl13/ct/eps-plc-01 | DI_DISET_EH01_02_LIM_DI          | DevBoolean           |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| sample_changer           | ---                        | ---                  | ---                      | ---                  | bl13/eh/cats       | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| eps                      | ---                        | ---                  | eps                      | devnames             | bl13/ct/eps-plc-01 | ---                              | ---                  |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+
| blvariables              | SafetyVector, Calibration, | DevDouble (Spectrum) | ---                      | ---                  | bl13/ct/variables  | diff_safevector, oav_pixelsize   | DevDouble, DevDouble |
+--------------------------+----------------------------+----------------------+--------------------------+----------------------+--------------------+----------------------------------+----------------------+

Additional DS attributes are:

    * MountingPosition (DevDouble, spectrum)
    * CurrentPhase (DevString)
    * BeamstopType (DevString)
    * SampleMode (DevString)
    * PinLength (DevFloat)
    * KappPresence (DevBoolean)

**Phase definitions**

+------------+-------------------+------------------+----------+----------------+----------+
|            | Transfer (SAMPLE) | Transfer (PLATE) | Collect  | SampleView     | BeamView |
+============+===================+==================+==========+================+==========+
| YAG        | OUT (z=-94.6)     | OUT (z=-94.6)    | -        | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| Beamstop   | OUT (z=-95.7)     | OUT (z=-95.7)    | IN (z=0) | MIDDLE (z=-20) | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| Aperture   | OUT (z=-96.0)     | OUT (z=-96.0)    | -        | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| Backlight  | OUT               | OUT              | OUT      | IN             | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| omega      | 0                 | 90               | -        | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| omegax     | -                 | 15.5             | -        | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| omegay     | -                 | 3.3              | -        | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| kappa      | 0                 | -                | -        | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+
| ln2_cover  | CLOSED            | CLOSED           | OPEN     | -              | N/A      |
+------------+-------------------+------------------+----------+----------------+----------+


